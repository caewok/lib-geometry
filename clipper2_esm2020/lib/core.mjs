/*******************************************************************************
* Author    :  Angus Johnson                                                   *
* Date      :  19 September 2023                                               *
* Website   :  http://www.angusj.com                                           *
* Copyright :  Angus Johnson 2010-2023                                         *
* Purpose   :  Core structures and functions for the Clipper Library           *
* License   :  http://www.boost.org/LICENSE_1_0.txt                            *
*******************************************************************************/
import { PointInPolygonResult } from "./engine.mjs";
//
// Converted from C# implemention https://github.com/AngusJohnson/Clipper2/blob/main/CSharp/Clipper2Lib/Clipper.Core.cs
// Removed support for USINGZ
//
// Converted by ChatGPT 4 August 3 version https://help.openai.com/en/articles/6825453-chatgpt-release-notes
//
// Note: all clipping operations except for Difference are commutative.
export var ClipType;
(function (ClipType) {
    ClipType[ClipType["None"] = 0] = "None";
    ClipType[ClipType["Intersection"] = 1] = "Intersection";
    ClipType[ClipType["Union"] = 2] = "Union";
    ClipType[ClipType["Difference"] = 3] = "Difference";
    ClipType[ClipType["Xor"] = 4] = "Xor";
})(ClipType || (ClipType = {}));
export var PathType;
(function (PathType) {
    PathType[PathType["Subject"] = 0] = "Subject";
    PathType[PathType["Clip"] = 1] = "Clip";
})(PathType || (PathType = {}));
// By far the most widely used filling rules for polygons are EvenOdd
// and NonZero, sometimes called Alternate and Winding respectively.
// https://en.wikipedia.org/wiki/Nonzero-rule
export var FillRule;
(function (FillRule) {
    FillRule[FillRule["EvenOdd"] = 0] = "EvenOdd";
    FillRule[FillRule["NonZero"] = 1] = "NonZero";
    FillRule[FillRule["Positive"] = 2] = "Positive";
    FillRule[FillRule["Negative"] = 3] = "Negative";
})(FillRule || (FillRule = {}));
// PointInPolygon
export var PipResult;
(function (PipResult) {
    PipResult[PipResult["Inside"] = 0] = "Inside";
    PipResult[PipResult["Outside"] = 1] = "Outside";
    PipResult[PipResult["OnEdge"] = 2] = "OnEdge";
})(PipResult || (PipResult = {}));
export class Path64 extends Array {
}
export class Paths64 extends Array {
}
export class Rect64 {
    constructor(lOrIsValidOrRec, t, r, b) {
        if (typeof lOrIsValidOrRec === 'boolean') {
            if (lOrIsValidOrRec) {
                this.left = 0;
                this.top = 0;
                this.right = 0;
                this.bottom = 0;
            }
            else {
                this.left = Number.MAX_SAFE_INTEGER;
                this.top = Number.MAX_SAFE_INTEGER;
                this.right = Number.MIN_SAFE_INTEGER;
                this.bottom = Number.MIN_SAFE_INTEGER;
            }
        }
        else if (typeof lOrIsValidOrRec === 'number') {
            this.left = lOrIsValidOrRec;
            this.top = t;
            this.right = r;
            this.bottom = b;
        }
        else {
            this.left = lOrIsValidOrRec.left;
            this.top = lOrIsValidOrRec.top;
            this.right = lOrIsValidOrRec.right;
            this.bottom = lOrIsValidOrRec.bottom;
        }
    }
    get width() {
        return this.right - this.left;
    }
    set width(value) {
        this.right = this.left + value;
    }
    get height() {
        return this.bottom - this.top;
    }
    set height(value) {
        this.bottom = this.top + value;
    }
    isEmpty() {
        return this.bottom <= this.top || this.right <= this.left;
    }
    midPoint() {
        return new Point64((this.left + this.right) / 2, (this.top + this.bottom) / 2);
    }
    contains(pt) {
        return pt.x > this.left && pt.x < this.right && pt.y > this.top && pt.y < this.bottom;
    }
    containsRect(rec) {
        return rec.left >= this.left && rec.right <= this.right && rec.top >= this.top && rec.bottom <= this.bottom;
    }
    intersects(rec) {
        return (Math.max(this.left, rec.left) <= Math.min(this.right, rec.right)) &&
            (Math.max(this.top, rec.top) <= Math.min(this.bottom, rec.bottom));
    }
    asPath() {
        const result = new Path64();
        result.push(new Point64(this.left, this.top));
        result.push(new Point64(this.right, this.top));
        result.push(new Point64(this.right, this.bottom));
        result.push(new Point64(this.left, this.bottom));
        return result;
    }
}
export var MidpointRounding;
(function (MidpointRounding) {
    MidpointRounding[MidpointRounding["ToEven"] = 0] = "ToEven";
    MidpointRounding[MidpointRounding["AwayFromZero"] = 1] = "AwayFromZero";
})(MidpointRounding || (MidpointRounding = {}));
export function midPointRound(value, mode = MidpointRounding.ToEven) {
    const factor = Math.pow(10, 0);
    value *= factor;
    let rounded;
    if (mode === MidpointRounding.AwayFromZero) {
        rounded = (value > 0) ? Math.floor(value + 0.5) : Math.ceil(value - 0.5);
    }
    else {
        // For MidpointRounding.ToEven, use the default JavaScript rounding
        rounded = Math.round(value);
    }
    return rounded / factor;
}
export class Point64 {
    constructor(xOrPt, yOrScale) {
        if (typeof xOrPt === 'number' && typeof yOrScale === 'number') {
            this.x = midPointRound(xOrPt, MidpointRounding.AwayFromZero);
            this.y = midPointRound(yOrScale, MidpointRounding.AwayFromZero);
        }
        else {
            const pt = xOrPt;
            if (yOrScale !== undefined) {
                this.x = midPointRound(pt.x * yOrScale, MidpointRounding.AwayFromZero);
                this.y = midPointRound(pt.y * yOrScale, MidpointRounding.AwayFromZero);
            }
            else {
                this.x = pt.x;
                this.y = pt.y;
            }
        }
    }
    static equals(lhs, rhs) {
        return lhs.x === rhs.x && lhs.y === rhs.y;
    }
    static notEquals(lhs, rhs) {
        return lhs.x !== rhs.x || lhs.y !== rhs.y;
    }
    static add(lhs, rhs) {
        return new Point64(lhs.x + rhs.x, lhs.y + rhs.y);
    }
    static subtract(lhs, rhs) {
        return new Point64(lhs.x - rhs.x, lhs.y - rhs.y);
    }
    toString() {
        return `${this.x},${this.y} `;
    }
    equals(obj) {
        if (obj instanceof Point64) {
            return Point64.equals(this, obj);
        }
        return false;
    }
}
export class InternalClipper {
    static checkPrecision(precision) {
        if (precision < -8 || precision > 8)
            throw new Error(this.precision_range_error);
    }
    static isAlmostZero(value) {
        return (Math.abs(value) <= this.floatingPointTolerance);
    }
    static crossProduct(pt1, pt2, pt3) {
        return ((pt2.x - pt1.x) * (pt3.y - pt2.y) - (pt2.y - pt1.y) * (pt3.x - pt2.x));
    }
    static dotProduct(pt1, pt2, pt3) {
        return ((pt2.x - pt1.x) * (pt3.x - pt2.x) + (pt2.y - pt1.y) * (pt3.y - pt2.y));
    }
    static checkCastInt64(val) {
        if ((val >= this.max_coord) || (val <= this.min_coord))
            return this.Invalid64;
        return midPointRound(val, MidpointRounding.AwayFromZero);
    }
    static getIntersectPoint(ln1a, ln1b, ln2a, ln2b) {
        const dy1 = ln1b.y - ln1a.y;
        const dx1 = ln1b.x - ln1a.x;
        const dy2 = ln2b.y - ln2a.y;
        const dx2 = ln2b.x - ln2a.x;
        const det = dy1 * dx2 - dy2 * dx1;
        let ip;
        if (det === 0.0) {
            ip = new Point64(0, 0);
            return { ip, success: false };
        }
        const t = ((ln1a.x - ln2a.x) * dy2 - (ln1a.y - ln2a.y) * dx2) / det;
        if (t <= 0.0)
            ip = ln1a;
        else if (t >= 1.0)
            ip = ln1b;
        // NB: truncate the result instead of rounding it, to make the C# version work similarly to the C++ and Delphi versions
        else
            ip = new Point64(Math.trunc(ln1a.x + t * dx1), Math.trunc(ln1a.y + t * dy1));
        return { ip, success: true };
    }
    static segsIntersect(seg1a, seg1b, seg2a, seg2b, inclusive = false) {
        if (inclusive) {
            const res1 = InternalClipper.crossProduct(seg1a, seg2a, seg2b);
            const res2 = InternalClipper.crossProduct(seg1b, seg2a, seg2b);
            if (res1 * res2 > 0)
                return false;
            const res3 = InternalClipper.crossProduct(seg2a, seg1a, seg1b);
            const res4 = InternalClipper.crossProduct(seg2b, seg1a, seg1b);
            if (res3 * res4 > 0)
                return false;
            return (res1 !== 0 || res2 !== 0 || res3 !== 0 || res4 !== 0);
        }
        else {
            return (InternalClipper.crossProduct(seg1a, seg2a, seg2b) * InternalClipper.crossProduct(seg1b, seg2a, seg2b) < 0) &&
                (InternalClipper.crossProduct(seg2a, seg1a, seg1b) * InternalClipper.crossProduct(seg2b, seg1a, seg1b) < 0);
        }
    }
    static getClosestPtOnSegment(offPt, seg1, seg2) {
        if (seg1.x === seg2.x && seg1.y === seg2.y)
            return seg1;
        const dx = seg2.x - seg1.x;
        const dy = seg2.y - seg1.y;
        let q = ((offPt.x - seg1.x) * dx + (offPt.y - seg1.y) * dy) / ((dx * dx) + (dy * dy));
        if (q < 0)
            q = 0;
        else if (q > 1)
            q = 1;
        // use MidpointRounding.ToEven in order to explicitly match the nearbyint behaviour on the C++ side
        return new Point64(seg1.x + midPointRound(q * dx, MidpointRounding.ToEven), seg1.y + midPointRound(q * dy, MidpointRounding.ToEven));
    }
    static pointInPolygon(pt, polygon) {
        const len = polygon.length;
        let start = 0;
        if (len < 3)
            return PointInPolygonResult.IsOutside;
        while (start < len && polygon[start].y === pt.y)
            start++;
        if (start === len)
            return PointInPolygonResult.IsOutside;
        let d = 0;
        let isAbove = polygon[start].y < pt.y;
        const startingAbove = isAbove;
        let val = 0;
        let i = start + 1;
        let end = len;
        for (;;) {
            if (i === end) {
                if (end === 0 || start === 0)
                    break;
                end = start;
                i = 0;
            }
            if (isAbove) {
                while (i < end && polygon[i].y < pt.y)
                    i++;
                if (i === end)
                    continue;
            }
            else {
                while (i < end && polygon[i].y > pt.y)
                    i++;
                if (i === end)
                    continue;
            }
            const curr = polygon[i];
            const prev = i > 0 ? polygon[i - 1] : polygon[len - 1];
            if (curr.y === pt.y) {
                if (curr.x === pt.x || (curr.y === prev.y && (pt.x < prev.x !== pt.x < curr.x)))
                    return PointInPolygonResult.IsOn;
                i++;
                if (i === start)
                    break;
                continue;
            }
            if (pt.x < curr.x && pt.x < prev.x) {
                // we're only interested in edges crossing on the left
            }
            else if (pt.x > prev.x && pt.x > curr.x) {
                val = 1 - val; // toggle val
            }
            else {
                d = InternalClipper.crossProduct(prev, curr, pt);
                if (d === 0)
                    return PointInPolygonResult.IsOn;
                if ((d < 0) === isAbove)
                    val = 1 - val;
            }
            isAbove = !isAbove;
            i++;
        }
        if (isAbove !== startingAbove) {
            if (i === len)
                i = 0;
            else
                d = InternalClipper.crossProduct(polygon[i - 1], polygon[i], pt);
            if (d === 0)
                return PointInPolygonResult.IsOn;
            if ((d < 0) === isAbove)
                val = 1 - val;
        }
        if (val === 0)
            return PointInPolygonResult.IsOutside;
        return PointInPolygonResult.IsInside;
    }
}
InternalClipper.MaxInt64 = 9223372036854775807;
InternalClipper.MaxCoord = InternalClipper.MaxInt64 / 4;
InternalClipper.max_coord = InternalClipper.MaxCoord;
InternalClipper.min_coord = -InternalClipper.MaxCoord;
InternalClipper.Invalid64 = InternalClipper.MaxInt64;
InternalClipper.defaultArcTolerance = 0.25;
InternalClipper.floatingPointTolerance = 1E-12;
InternalClipper.defaultMinimumEdgeLength = 0.1;
InternalClipper.precision_range_error = "Error: Precision is out of range.";
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2NsaXBwZXIyLWpzL3NyYy9saWIvY29yZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztnRkFPZ0Y7QUFFaEYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWhELEVBQUU7QUFDRix1SEFBdUg7QUFDdkgsNkJBQTZCO0FBQzdCLEVBQUU7QUFDRiw0R0FBNEc7QUFDNUcsRUFBRTtBQUVGLHVFQUF1RTtBQUN2RSxNQUFNLENBQU4sSUFBWSxRQU1YO0FBTkQsV0FBWSxRQUFRO0lBQ2xCLHVDQUFJLENBQUE7SUFDSix1REFBWSxDQUFBO0lBQ1oseUNBQUssQ0FBQTtJQUNMLG1EQUFVLENBQUE7SUFDVixxQ0FBRyxDQUFBO0FBQ0wsQ0FBQyxFQU5XLFFBQVEsS0FBUixRQUFRLFFBTW5CO0FBRUQsTUFBTSxDQUFOLElBQVksUUFHWDtBQUhELFdBQVksUUFBUTtJQUNsQiw2Q0FBTyxDQUFBO0lBQ1AsdUNBQUksQ0FBQTtBQUNOLENBQUMsRUFIVyxRQUFRLEtBQVIsUUFBUSxRQUduQjtBQUVELHFFQUFxRTtBQUNyRSxvRUFBb0U7QUFDcEUsNkNBQTZDO0FBQzdDLE1BQU0sQ0FBTixJQUFZLFFBS1g7QUFMRCxXQUFZLFFBQVE7SUFDbEIsNkNBQU8sQ0FBQTtJQUNQLDZDQUFPLENBQUE7SUFDUCwrQ0FBUSxDQUFBO0lBQ1IsK0NBQVEsQ0FBQTtBQUNWLENBQUMsRUFMVyxRQUFRLEtBQVIsUUFBUSxRQUtuQjtBQUVELGlCQUFpQjtBQUNqQixNQUFNLENBQU4sSUFBWSxTQUlYO0FBSkQsV0FBWSxTQUFTO0lBQ25CLDZDQUFNLENBQUE7SUFDTiwrQ0FBTyxDQUFBO0lBQ1AsNkNBQU0sQ0FBQTtBQUNSLENBQUMsRUFKVyxTQUFTLEtBQVQsU0FBUyxRQUlwQjtBQU9ELE1BQU0sT0FBTyxNQUFPLFNBQVEsS0FBZTtDQUFJO0FBRS9DLE1BQU0sT0FBTyxPQUFRLFNBQVEsS0FBYTtDQUFJO0FBSTlDLE1BQU0sT0FBTyxNQUFNO0lBTWpCLFlBQVksZUFBMkMsRUFBRSxDQUFVLEVBQUUsQ0FBVSxFQUFFLENBQVU7UUFDekYsSUFBSSxPQUFPLGVBQWUsS0FBSyxTQUFTLEVBQUU7WUFDeEMsSUFBSSxlQUFlLEVBQUU7Z0JBQ25CLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO2dCQUNkLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO2dCQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO2dCQUNmLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO2FBQ2pCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUNwQyxJQUFJLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDbkMsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3JDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2FBQ3ZDO1NBQ0Y7YUFBTSxJQUFJLE9BQU8sZUFBZSxLQUFLLFFBQVEsRUFBRTtZQUM5QyxJQUFJLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQztZQUM1QixJQUFJLENBQUMsR0FBRyxHQUFHLENBQVcsQ0FBQztZQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLENBQVcsQ0FBQztZQUN6QixJQUFJLENBQUMsTUFBTSxHQUFHLENBQVcsQ0FBQztTQUMzQjthQUFNO1lBQ0wsSUFBSSxDQUFDLElBQUksR0FBRyxlQUFnQixDQUFDLElBQUksQ0FBQztZQUNsQyxJQUFJLENBQUMsR0FBRyxHQUFHLGVBQWdCLENBQUMsR0FBRyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxLQUFLLEdBQUcsZUFBZ0IsQ0FBQyxLQUFLLENBQUM7WUFDcEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxlQUFnQixDQUFDLE1BQU0sQ0FBQztTQUN2QztJQUNILENBQUM7SUFFRCxJQUFXLEtBQUs7UUFDZCxPQUFPLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztJQUNoQyxDQUFDO0lBRUQsSUFBVyxLQUFLLENBQUMsS0FBYTtRQUM1QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxJQUFXLE1BQU07UUFDZixPQUFPLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNoQyxDQUFDO0lBRUQsSUFBVyxNQUFNLENBQUMsS0FBYTtRQUM3QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDO0lBQ2pDLENBQUM7SUFFTSxPQUFPO1FBQ1osT0FBTyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQzVELENBQUM7SUFFTSxRQUFRO1FBQ2IsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7SUFFTSxRQUFRLENBQUMsRUFBWTtRQUMxQixPQUFPLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN4RixDQUFDO0lBRU0sWUFBWSxDQUFDLEdBQVc7UUFDN0IsT0FBTyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLEdBQUcsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDOUcsQ0FBQztJQUVNLFVBQVUsQ0FBQyxHQUFXO1FBQzNCLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN2RSxDQUFDO0lBRU0sTUFBTTtRQUNYLE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7UUFDNUIsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ2pELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Q0FDRjtBQUVELE1BQU0sQ0FBTixJQUFZLGdCQUdYO0FBSEQsV0FBWSxnQkFBZ0I7SUFDMUIsMkRBQU0sQ0FBQTtJQUNOLHVFQUFZLENBQUE7QUFDZCxDQUFDLEVBSFcsZ0JBQWdCLEtBQWhCLGdCQUFnQixRQUczQjtBQUVELE1BQU0sVUFBVSxhQUFhLENBQUMsS0FBYSxFQUFFLE9BQXlCLGdCQUFnQixDQUFDLE1BQU07SUFDM0YsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDL0IsS0FBSyxJQUFJLE1BQU0sQ0FBQztJQUVoQixJQUFJLE9BQWUsQ0FBQztJQUNwQixJQUFJLElBQUksS0FBSyxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUU7UUFDMUMsT0FBTyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLENBQUM7S0FDMUU7U0FBTTtRQUNMLG1FQUFtRTtRQUNuRSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUM3QjtJQUVELE9BQU8sT0FBTyxHQUFHLE1BQU0sQ0FBQztBQUMxQixDQUFDO0FBR0QsTUFBTSxPQUFPLE9BQU87SUFJbEIsWUFBWSxLQUF3QixFQUFFLFFBQWlCO1FBQ3JELElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxJQUFJLE9BQU8sUUFBUSxLQUFLLFFBQVEsRUFBRTtZQUM3RCxJQUFJLENBQUMsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxLQUFLLEVBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDNUQsSUFBSSxDQUFDLENBQUMsR0FBRyxhQUFhLENBQUMsUUFBUSxFQUFFLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ2pFO2FBQU87WUFDTixNQUFNLEVBQUUsR0FBRyxLQUFnQixDQUFBO1lBQzNCLElBQUksUUFBUSxLQUFLLFNBQVMsRUFBRTtnQkFDMUIsSUFBSSxDQUFDLENBQUMsR0FBRyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxRQUFRLEVBQUUsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ3ZFLElBQUksQ0FBQyxDQUFDLEdBQUcsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsUUFBUSxFQUFFLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3hFO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDZCxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDZjtTQUNGO0lBQ0gsQ0FBQztJQUVNLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBWSxFQUFFLEdBQVk7UUFDN0MsT0FBTyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFTSxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQVksRUFBRSxHQUFZO1FBQ2hELE9BQU8sR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRU0sTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFZLEVBQUUsR0FBWTtRQUMxQyxPQUFPLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFZLEVBQUUsR0FBWTtRQUMvQyxPQUFPLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRU0sUUFBUTtRQUNiLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQztJQUNoQyxDQUFDO0lBRU0sTUFBTSxDQUFDLEdBQVk7UUFDeEIsSUFBSSxHQUFHLFlBQVksT0FBTyxFQUFFO1lBQzFCLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDbEM7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7Q0FLRjtBQUVELE1BQU0sT0FBTyxlQUFlO0lBYTFCLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBaUI7UUFDckMsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDLElBQUksU0FBUyxHQUFHLENBQUM7WUFDakMsTUFBTSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFhO1FBQy9CLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFRCxNQUFNLENBQUMsWUFBWSxDQUFDLEdBQWEsRUFBRSxHQUFhLEVBQUUsR0FBYTtRQUM3RCxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7SUFFRCxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQWEsRUFBRSxHQUFhLEVBQUUsR0FBYTtRQUMzRCxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7SUFFRCxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQVc7UUFDL0IsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUFFLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUM5RSxPQUFPLGFBQWEsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUdNLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFjLEVBQUUsSUFBYyxFQUFFLElBQWMsRUFBRSxJQUFjO1FBQzVGLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM1QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDNUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzVCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM1QixNQUFNLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFFbEMsSUFBSSxFQUFZLENBQUM7UUFFakIsSUFBSSxHQUFHLEtBQUssR0FBRyxFQUFFO1lBQ2YsRUFBRSxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN2QixPQUFPLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQztTQUMvQjtRQUVELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDcEUsSUFBSSxDQUFDLElBQUksR0FBRztZQUFFLEVBQUUsR0FBRyxJQUFJLENBQUM7YUFDbkIsSUFBSSxDQUFDLElBQUksR0FBRztZQUFFLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDN0IsdUhBQXVIOztZQUNsSCxFQUFFLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDbEYsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUdNLE1BQU0sQ0FBQyxhQUFhLENBQUMsS0FBZSxFQUFFLEtBQWUsRUFBRSxLQUFlLEVBQUUsS0FBZSxFQUFFLFlBQXFCLEtBQUs7UUFDeEgsSUFBSSxTQUFTLEVBQUU7WUFDYixNQUFNLElBQUksR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsTUFBTSxJQUFJLEdBQUcsZUFBZSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQy9ELElBQUksSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDO2dCQUFFLE9BQU8sS0FBSyxDQUFDO1lBQ2xDLE1BQU0sSUFBSSxHQUFHLGVBQWUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMvRCxNQUFNLElBQUksR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUM7Z0JBQUUsT0FBTyxLQUFLLENBQUM7WUFDbEMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLElBQUksSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxJQUFJLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQztTQUMvRDthQUFNO1lBQ0wsT0FBTyxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoSCxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDL0c7SUFDSCxDQUFDO0lBRU0sTUFBTSxDQUFDLHFCQUFxQixDQUFDLEtBQWUsRUFBRSxJQUFjLEVBQUUsSUFBYztRQUNqRixJQUFJLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFDeEQsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzNCLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3RGLElBQUksQ0FBQyxHQUFHLENBQUM7WUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQU0sSUFBSSxDQUFDLEdBQUcsQ0FBQztZQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEMsbUdBQW1HO1FBQ25HLE9BQU8sSUFBSSxPQUFPLENBQ2hCLElBQUksQ0FBQyxDQUFDLEdBQUcsYUFBYSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEVBQ3ZELElBQUksQ0FBQyxDQUFDLEdBQUcsYUFBYSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQ3hELENBQUM7SUFDSixDQUFDO0lBRU0sTUFBTSxDQUFDLGNBQWMsQ0FBQyxFQUFZLEVBQUUsT0FBZTtRQUN4RCxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBQzNCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztRQUVkLElBQUksR0FBRyxHQUFHLENBQUM7WUFBRSxPQUFPLG9CQUFvQixDQUFDLFNBQVMsQ0FBQztRQUVuRCxPQUFPLEtBQUssR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUFFLEtBQUssRUFBRSxDQUFDO1FBQ3pELElBQUksS0FBSyxLQUFLLEdBQUc7WUFBRSxPQUFPLG9CQUFvQixDQUFDLFNBQVMsQ0FBQztRQUV6RCxJQUFJLENBQUMsR0FBVyxDQUFDLENBQUM7UUFDbEIsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQztRQUM5QixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDWixJQUFJLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUVkLFNBQVU7WUFDUixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUU7Z0JBQ2IsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDO29CQUFFLE1BQU07Z0JBQ3BDLEdBQUcsR0FBRyxLQUFLLENBQUM7Z0JBQ1osQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNQO1lBRUQsSUFBSSxPQUFPLEVBQUU7Z0JBQ1gsT0FBTyxDQUFDLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7b0JBQUUsQ0FBQyxFQUFFLENBQUM7Z0JBQzNDLElBQUksQ0FBQyxLQUFLLEdBQUc7b0JBQUUsU0FBUzthQUN6QjtpQkFBTTtnQkFDTCxPQUFPLENBQUMsR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztvQkFBRSxDQUFDLEVBQUUsQ0FBQztnQkFDM0MsSUFBSSxDQUFDLEtBQUssR0FBRztvQkFBRSxTQUFTO2FBQ3pCO1lBRUQsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFFdkQsSUFBSSxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUU7Z0JBQ25CLElBQUksSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUFFLE9BQU8sb0JBQW9CLENBQUMsSUFBSSxDQUFDO2dCQUNsSCxDQUFDLEVBQUUsQ0FBQztnQkFDSixJQUFJLENBQUMsS0FBSyxLQUFLO29CQUFFLE1BQU07Z0JBQ3ZCLFNBQVM7YUFDVjtZQUVELElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsRUFBRTtnQkFDbEMsc0RBQXNEO2FBQ3ZEO2lCQUFNLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsRUFBRTtnQkFDekMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxhQUFhO2FBQzdCO2lCQUFNO2dCQUNMLENBQUMsR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ2pELElBQUksQ0FBQyxLQUFLLENBQUM7b0JBQUUsT0FBTyxvQkFBb0IsQ0FBQyxJQUFJLENBQUM7Z0JBQzlDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssT0FBTztvQkFBRSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQzthQUN4QztZQUNELE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQztZQUNuQixDQUFDLEVBQUUsQ0FBQztTQUNMO1FBRUQsSUFBSSxPQUFPLEtBQUssYUFBYSxFQUFFO1lBQzdCLElBQUksQ0FBQyxLQUFLLEdBQUc7Z0JBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQzs7Z0JBQ2hCLENBQUMsR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3RFLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQUUsT0FBTyxvQkFBb0IsQ0FBQyxJQUFJLENBQUM7WUFDOUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxPQUFPO2dCQUFFLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1NBQ3hDO1FBRUQsSUFBSSxHQUFHLEtBQUssQ0FBQztZQUFFLE9BQU8sb0JBQW9CLENBQUMsU0FBUyxDQUFDO1FBQ3JELE9BQU8sb0JBQW9CLENBQUMsUUFBUSxDQUFDO0lBQ3ZDLENBQUM7O0FBckplLHdCQUFRLEdBQVcsbUJBQW1CLENBQUM7QUFDdkMsd0JBQVEsR0FBVyxlQUFlLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztBQUNoRCx5QkFBUyxHQUFXLGVBQWUsQ0FBQyxRQUFRLENBQUM7QUFDN0MseUJBQVMsR0FBVyxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUM7QUFDOUMseUJBQVMsR0FBVyxlQUFlLENBQUMsUUFBUSxDQUFDO0FBRTdDLG1DQUFtQixHQUFXLElBQUksQ0FBQztBQUNuQyxzQ0FBc0IsR0FBVyxLQUFLLENBQUM7QUFDdkMsd0NBQXdCLEdBQVcsR0FBRyxDQUFDO0FBRS9CLHFDQUFxQixHQUFXLG1DQUFtQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuKiBBdXRob3IgICAgOiAgQW5ndXMgSm9obnNvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcclxuKiBEYXRlICAgICAgOiAgMTkgU2VwdGVtYmVyIDIwMjMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcclxuKiBXZWJzaXRlICAgOiAgaHR0cDovL3d3dy5hbmd1c2ouY29tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcclxuKiBDb3B5cmlnaHQgOiAgQW5ndXMgSm9obnNvbiAyMDEwLTIwMjMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcclxuKiBQdXJwb3NlICAgOiAgQ29yZSBzdHJ1Y3R1cmVzIGFuZCBmdW5jdGlvbnMgZm9yIHRoZSBDbGlwcGVyIExpYnJhcnkgICAgICAgICAgICpcclxuKiBMaWNlbnNlICAgOiAgaHR0cDovL3d3dy5ib29zdC5vcmcvTElDRU5TRV8xXzAudHh0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuXHJcbmltcG9ydCB7IFBvaW50SW5Qb2x5Z29uUmVzdWx0IH0gZnJvbSBcIi4vZW5naW5lXCI7XHJcblxyXG4vL1xyXG4vLyBDb252ZXJ0ZWQgZnJvbSBDIyBpbXBsZW1lbnRpb24gaHR0cHM6Ly9naXRodWIuY29tL0FuZ3VzSm9obnNvbi9DbGlwcGVyMi9ibG9iL21haW4vQ1NoYXJwL0NsaXBwZXIyTGliL0NsaXBwZXIuQ29yZS5jc1xyXG4vLyBSZW1vdmVkIHN1cHBvcnQgZm9yIFVTSU5HWlxyXG4vL1xyXG4vLyBDb252ZXJ0ZWQgYnkgQ2hhdEdQVCA0IEF1Z3VzdCAzIHZlcnNpb24gaHR0cHM6Ly9oZWxwLm9wZW5haS5jb20vZW4vYXJ0aWNsZXMvNjgyNTQ1My1jaGF0Z3B0LXJlbGVhc2Utbm90ZXNcclxuLy9cclxuXHJcbi8vIE5vdGU6IGFsbCBjbGlwcGluZyBvcGVyYXRpb25zIGV4Y2VwdCBmb3IgRGlmZmVyZW5jZSBhcmUgY29tbXV0YXRpdmUuXHJcbmV4cG9ydCBlbnVtIENsaXBUeXBlIHtcclxuICBOb25lLFxyXG4gIEludGVyc2VjdGlvbixcclxuICBVbmlvbixcclxuICBEaWZmZXJlbmNlLFxyXG4gIFhvclxyXG59XHJcblxyXG5leHBvcnQgZW51bSBQYXRoVHlwZSB7XHJcbiAgU3ViamVjdCxcclxuICBDbGlwXHJcbn1cclxuXHJcbi8vIEJ5IGZhciB0aGUgbW9zdCB3aWRlbHkgdXNlZCBmaWxsaW5nIHJ1bGVzIGZvciBwb2x5Z29ucyBhcmUgRXZlbk9kZFxyXG4vLyBhbmQgTm9uWmVybywgc29tZXRpbWVzIGNhbGxlZCBBbHRlcm5hdGUgYW5kIFdpbmRpbmcgcmVzcGVjdGl2ZWx5LlxyXG4vLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Ob256ZXJvLXJ1bGVcclxuZXhwb3J0IGVudW0gRmlsbFJ1bGUge1xyXG4gIEV2ZW5PZGQsXHJcbiAgTm9uWmVybyxcclxuICBQb3NpdGl2ZSxcclxuICBOZWdhdGl2ZVxyXG59XHJcblxyXG4vLyBQb2ludEluUG9seWdvblxyXG5leHBvcnQgZW51bSBQaXBSZXN1bHQge1xyXG4gIEluc2lkZSxcclxuICBPdXRzaWRlLFxyXG4gIE9uRWRnZVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQb2ludDY0IHtcclxuICB4OiBudW1iZXI7XHJcbiAgeTogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUGF0aDY0IGV4dGVuZHMgQXJyYXk8SVBvaW50NjQ+IHsgfVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhdGhzNjQgZXh0ZW5kcyBBcnJheTxQYXRoNjQ+IHsgfVxyXG5cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgUmVjdDY0IHtcclxuICBwdWJsaWMgbGVmdDogbnVtYmVyO1xyXG4gIHB1YmxpYyB0b3A6IG51bWJlcjtcclxuICBwdWJsaWMgcmlnaHQ6IG51bWJlcjtcclxuICBwdWJsaWMgYm90dG9tOiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGxPcklzVmFsaWRPclJlYz86IG51bWJlciB8IGJvb2xlYW4gfCBSZWN0NjQsIHQ/OiBudW1iZXIsIHI/OiBudW1iZXIsIGI/OiBudW1iZXIpIHtcclxuICAgIGlmICh0eXBlb2YgbE9ySXNWYWxpZE9yUmVjID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgaWYgKGxPcklzVmFsaWRPclJlYykge1xyXG4gICAgICAgIHRoaXMubGVmdCA9IDA7XHJcbiAgICAgICAgdGhpcy50b3AgPSAwO1xyXG4gICAgICAgIHRoaXMucmlnaHQgPSAwO1xyXG4gICAgICAgIHRoaXMuYm90dG9tID0gMDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmxlZnQgPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtcclxuICAgICAgICB0aGlzLnRvcCA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSO1xyXG4gICAgICAgIHRoaXMucmlnaHQgPSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjtcclxuICAgICAgICB0aGlzLmJvdHRvbSA9IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBsT3JJc1ZhbGlkT3JSZWMgPT09ICdudW1iZXInKSB7XHJcbiAgICAgIHRoaXMubGVmdCA9IGxPcklzVmFsaWRPclJlYztcclxuICAgICAgdGhpcy50b3AgPSB0IGFzIG51bWJlcjtcclxuICAgICAgdGhpcy5yaWdodCA9IHIgYXMgbnVtYmVyO1xyXG4gICAgICB0aGlzLmJvdHRvbSA9IGIgYXMgbnVtYmVyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5sZWZ0ID0gbE9ySXNWYWxpZE9yUmVjIS5sZWZ0O1xyXG4gICAgICB0aGlzLnRvcCA9IGxPcklzVmFsaWRPclJlYyEudG9wO1xyXG4gICAgICB0aGlzLnJpZ2h0ID0gbE9ySXNWYWxpZE9yUmVjIS5yaWdodDtcclxuICAgICAgdGhpcy5ib3R0b20gPSBsT3JJc1ZhbGlkT3JSZWMhLmJvdHRvbTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgd2lkdGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLnJpZ2h0IC0gdGhpcy5sZWZ0O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCB3aWR0aCh2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnJpZ2h0ID0gdGhpcy5sZWZ0ICsgdmFsdWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGhlaWdodCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuYm90dG9tIC0gdGhpcy50b3A7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGhlaWdodCh2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLmJvdHRvbSA9IHRoaXMudG9wICsgdmFsdWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNFbXB0eSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmJvdHRvbSA8PSB0aGlzLnRvcCB8fCB0aGlzLnJpZ2h0IDw9IHRoaXMubGVmdDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBtaWRQb2ludCgpOiBQb2ludDY0IHtcclxuICAgIHJldHVybiBuZXcgUG9pbnQ2NCgodGhpcy5sZWZ0ICsgdGhpcy5yaWdodCkgLyAyLCAodGhpcy50b3AgKyB0aGlzLmJvdHRvbSkgLyAyKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb250YWlucyhwdDogSVBvaW50NjQpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBwdC54ID4gdGhpcy5sZWZ0ICYmIHB0LnggPCB0aGlzLnJpZ2h0ICYmIHB0LnkgPiB0aGlzLnRvcCAmJiBwdC55IDwgdGhpcy5ib3R0b207XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY29udGFpbnNSZWN0KHJlYzogUmVjdDY0KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gcmVjLmxlZnQgPj0gdGhpcy5sZWZ0ICYmIHJlYy5yaWdodCA8PSB0aGlzLnJpZ2h0ICYmIHJlYy50b3AgPj0gdGhpcy50b3AgJiYgcmVjLmJvdHRvbSA8PSB0aGlzLmJvdHRvbTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpbnRlcnNlY3RzKHJlYzogUmVjdDY0KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKE1hdGgubWF4KHRoaXMubGVmdCwgcmVjLmxlZnQpIDw9IE1hdGgubWluKHRoaXMucmlnaHQsIHJlYy5yaWdodCkpICYmXHJcbiAgICAgIChNYXRoLm1heCh0aGlzLnRvcCwgcmVjLnRvcCkgPD0gTWF0aC5taW4odGhpcy5ib3R0b20sIHJlYy5ib3R0b20pKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc1BhdGgoKTogUGF0aDY0IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBQYXRoNjQoKTtcclxuICAgIHJlc3VsdC5wdXNoKG5ldyBQb2ludDY0KHRoaXMubGVmdCwgdGhpcy50b3ApKTtcclxuICAgIHJlc3VsdC5wdXNoKG5ldyBQb2ludDY0KHRoaXMucmlnaHQsIHRoaXMudG9wKSk7XHJcbiAgICByZXN1bHQucHVzaChuZXcgUG9pbnQ2NCh0aGlzLnJpZ2h0LCB0aGlzLmJvdHRvbSkpO1xyXG4gICAgcmVzdWx0LnB1c2gobmV3IFBvaW50NjQodGhpcy5sZWZ0LCB0aGlzLmJvdHRvbSkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBlbnVtIE1pZHBvaW50Um91bmRpbmcge1xyXG4gIFRvRXZlbixcclxuICBBd2F5RnJvbVplcm9cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1pZFBvaW50Um91bmQodmFsdWU6IG51bWJlciwgbW9kZTogTWlkcG9pbnRSb3VuZGluZyA9IE1pZHBvaW50Um91bmRpbmcuVG9FdmVuKTogbnVtYmVyIHtcclxuICBjb25zdCBmYWN0b3IgPSBNYXRoLnBvdygxMCwgMCk7XHJcbiAgdmFsdWUgKj0gZmFjdG9yO1xyXG5cclxuICBsZXQgcm91bmRlZDogbnVtYmVyO1xyXG4gIGlmIChtb2RlID09PSBNaWRwb2ludFJvdW5kaW5nLkF3YXlGcm9tWmVybykge1xyXG4gICAgcm91bmRlZCA9ICh2YWx1ZSA+IDApID8gTWF0aC5mbG9vcih2YWx1ZSArIDAuNSkgOiBNYXRoLmNlaWwodmFsdWUgLSAwLjUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBGb3IgTWlkcG9pbnRSb3VuZGluZy5Ub0V2ZW4sIHVzZSB0aGUgZGVmYXVsdCBKYXZhU2NyaXB0IHJvdW5kaW5nXHJcbiAgICByb3VuZGVkID0gTWF0aC5yb3VuZCh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcm91bmRlZCAvIGZhY3RvcjtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBQb2ludDY0IGltcGxlbWVudHMgSVBvaW50NjQge1xyXG4gIHB1YmxpYyB4OiBudW1iZXI7XHJcbiAgcHVibGljIHk6IG51bWJlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoeE9yUHQ/OiBudW1iZXIgfCBQb2ludDY0LCB5T3JTY2FsZT86IG51bWJlcikge1xyXG4gICAgaWYgKHR5cGVvZiB4T3JQdCA9PT0gJ251bWJlcicgJiYgdHlwZW9mIHlPclNjYWxlID09PSAnbnVtYmVyJykge1xyXG4gICAgICB0aGlzLnggPSBtaWRQb2ludFJvdW5kKHhPclB0LE1pZHBvaW50Um91bmRpbmcuQXdheUZyb21aZXJvKTtcclxuICAgICAgdGhpcy55ID0gbWlkUG9pbnRSb3VuZCh5T3JTY2FsZSwgTWlkcG9pbnRSb3VuZGluZy5Bd2F5RnJvbVplcm8pO1xyXG4gICAgfSBlbHNlICB7XHJcbiAgICAgIGNvbnN0IHB0ID0geE9yUHQgYXMgUG9pbnQ2NFxyXG4gICAgICBpZiAoeU9yU2NhbGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRoaXMueCA9IG1pZFBvaW50Um91bmQocHQueCAqIHlPclNjYWxlLCBNaWRwb2ludFJvdW5kaW5nLkF3YXlGcm9tWmVybyk7XHJcbiAgICAgICAgdGhpcy55ID0gbWlkUG9pbnRSb3VuZChwdC55ICogeU9yU2NhbGUsIE1pZHBvaW50Um91bmRpbmcuQXdheUZyb21aZXJvKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnggPSBwdC54O1xyXG4gICAgICAgIHRoaXMueSA9IHB0Lnk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgZXF1YWxzKGxoczogUG9pbnQ2NCwgcmhzOiBQb2ludDY0KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gbGhzLnggPT09IHJocy54ICYmIGxocy55ID09PSByaHMueTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgbm90RXF1YWxzKGxoczogUG9pbnQ2NCwgcmhzOiBQb2ludDY0KTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gbGhzLnggIT09IHJocy54IHx8IGxocy55ICE9PSByaHMueTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgYWRkKGxoczogUG9pbnQ2NCwgcmhzOiBQb2ludDY0KTogUG9pbnQ2NCB7XHJcbiAgICByZXR1cm4gbmV3IFBvaW50NjQobGhzLnggKyByaHMueCwgbGhzLnkgKyByaHMueSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIHN1YnRyYWN0KGxoczogUG9pbnQ2NCwgcmhzOiBQb2ludDY0KTogUG9pbnQ2NCB7XHJcbiAgICByZXR1cm4gbmV3IFBvaW50NjQobGhzLnggLSByaHMueCwgbGhzLnkgLSByaHMueSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdG9TdHJpbmcoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSBgO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGVxdWFscyhvYmo6IFBvaW50NjQpOiBib29sZWFuIHtcclxuICAgIGlmIChvYmogaW5zdGFuY2VvZiBQb2ludDY0KSB7XHJcbiAgICAgIHJldHVybiBQb2ludDY0LmVxdWFscyh0aGlzLCBvYmopO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLy8gIHB1YmxpYyBnZXRIYXNoQ29kZSgpOiBudW1iZXIge1xyXG4gIC8vICAgIHJldHVybiB0aGlzLlggXiB0aGlzLlk7ICAvLyBTaW1wbGUgWE9SLWJhc2VkIGhhc2ggY29tYmluYXRpb24uIEFkanVzdCBpZiBuZWVkZWQuXHJcbiAgLy8gIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEludGVybmFsQ2xpcHBlciB7XHJcbiAgc3RhdGljIHJlYWRvbmx5IE1heEludDY0OiBudW1iZXIgPSA5MjIzMzcyMDM2ODU0Nzc1ODA3O1xyXG4gIHN0YXRpYyByZWFkb25seSBNYXhDb29yZDogbnVtYmVyID0gSW50ZXJuYWxDbGlwcGVyLk1heEludDY0IC8gNDtcclxuICBzdGF0aWMgcmVhZG9ubHkgbWF4X2Nvb3JkOiBudW1iZXIgPSBJbnRlcm5hbENsaXBwZXIuTWF4Q29vcmQ7XHJcbiAgc3RhdGljIHJlYWRvbmx5IG1pbl9jb29yZDogbnVtYmVyID0gLUludGVybmFsQ2xpcHBlci5NYXhDb29yZDtcclxuICBzdGF0aWMgcmVhZG9ubHkgSW52YWxpZDY0OiBudW1iZXIgPSBJbnRlcm5hbENsaXBwZXIuTWF4SW50NjQ7XHJcblxyXG4gIHN0YXRpYyByZWFkb25seSBkZWZhdWx0QXJjVG9sZXJhbmNlOiBudW1iZXIgPSAwLjI1O1xyXG4gIHN0YXRpYyByZWFkb25seSBmbG9hdGluZ1BvaW50VG9sZXJhbmNlOiBudW1iZXIgPSAxRS0xMjtcclxuICBzdGF0aWMgcmVhZG9ubHkgZGVmYXVsdE1pbmltdW1FZGdlTGVuZ3RoOiBudW1iZXIgPSAwLjE7XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHByZWNpc2lvbl9yYW5nZV9lcnJvcjogc3RyaW5nID0gXCJFcnJvcjogUHJlY2lzaW9uIGlzIG91dCBvZiByYW5nZS5cIjtcclxuXHJcbiAgc3RhdGljIGNoZWNrUHJlY2lzaW9uKHByZWNpc2lvbjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBpZiAocHJlY2lzaW9uIDwgLTggfHwgcHJlY2lzaW9uID4gOClcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMucHJlY2lzaW9uX3JhbmdlX2Vycm9yKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBpc0FsbW9zdFplcm8odmFsdWU6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChNYXRoLmFicyh2YWx1ZSkgPD0gdGhpcy5mbG9hdGluZ1BvaW50VG9sZXJhbmNlKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjcm9zc1Byb2R1Y3QocHQxOiBJUG9pbnQ2NCwgcHQyOiBJUG9pbnQ2NCwgcHQzOiBJUG9pbnQ2NCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gKChwdDIueCAtIHB0MS54KSAqIChwdDMueSAtIHB0Mi55KSAtIChwdDIueSAtIHB0MS55KSAqIChwdDMueCAtIHB0Mi54KSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZG90UHJvZHVjdChwdDE6IElQb2ludDY0LCBwdDI6IElQb2ludDY0LCBwdDM6IElQb2ludDY0KTogbnVtYmVyIHtcclxuICAgIHJldHVybiAoKHB0Mi54IC0gcHQxLngpICogKHB0My54IC0gcHQyLngpICsgKHB0Mi55IC0gcHQxLnkpICogKHB0My55IC0gcHQyLnkpKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBjaGVja0Nhc3RJbnQ2NCh2YWw6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICBpZiAoKHZhbCA+PSB0aGlzLm1heF9jb29yZCkgfHwgKHZhbCA8PSB0aGlzLm1pbl9jb29yZCkpIHJldHVybiB0aGlzLkludmFsaWQ2NDtcclxuICAgIHJldHVybiBtaWRQb2ludFJvdW5kKHZhbCwgTWlkcG9pbnRSb3VuZGluZy5Bd2F5RnJvbVplcm8pO1xyXG4gIH1cclxuXHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW50ZXJzZWN0UG9pbnQobG4xYTogSVBvaW50NjQsIGxuMWI6IElQb2ludDY0LCBsbjJhOiBJUG9pbnQ2NCwgbG4yYjogSVBvaW50NjQpOiB7IGlwOiBJUG9pbnQ2NCwgc3VjY2VzczogYm9vbGVhbiB9IHtcclxuICAgIGNvbnN0IGR5MSA9IGxuMWIueSAtIGxuMWEueTtcclxuICAgIGNvbnN0IGR4MSA9IGxuMWIueCAtIGxuMWEueDtcclxuICAgIGNvbnN0IGR5MiA9IGxuMmIueSAtIGxuMmEueTtcclxuICAgIGNvbnN0IGR4MiA9IGxuMmIueCAtIGxuMmEueDtcclxuICAgIGNvbnN0IGRldCA9IGR5MSAqIGR4MiAtIGR5MiAqIGR4MTtcclxuXHJcbiAgICBsZXQgaXA6IElQb2ludDY0O1xyXG5cclxuICAgIGlmIChkZXQgPT09IDAuMCkge1xyXG4gICAgICBpcCA9IG5ldyBQb2ludDY0KDAsIDApO1xyXG4gICAgICByZXR1cm4geyBpcCwgc3VjY2VzczogZmFsc2UgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0ID0gKChsbjFhLnggLSBsbjJhLngpICogZHkyIC0gKGxuMWEueSAtIGxuMmEueSkgKiBkeDIpIC8gZGV0O1xyXG4gICAgaWYgKHQgPD0gMC4wKSBpcCA9IGxuMWE7XHJcbiAgICBlbHNlIGlmICh0ID49IDEuMCkgaXAgPSBsbjFiO1xyXG4gICAgLy8gTkI6IHRydW5jYXRlIHRoZSByZXN1bHQgaW5zdGVhZCBvZiByb3VuZGluZyBpdCwgdG8gbWFrZSB0aGUgQyMgdmVyc2lvbiB3b3JrIHNpbWlsYXJseSB0byB0aGUgQysrIGFuZCBEZWxwaGkgdmVyc2lvbnNcclxuICAgIGVsc2UgaXAgPSBuZXcgUG9pbnQ2NChNYXRoLnRydW5jKGxuMWEueCArIHQgKiBkeDEpLCBNYXRoLnRydW5jKGxuMWEueSArIHQgKiBkeTEpKTtcclxuICAgIHJldHVybiB7IGlwLCBzdWNjZXNzOiB0cnVlIH07XHJcbiAgfVxyXG5cclxuXHJcbiAgcHVibGljIHN0YXRpYyBzZWdzSW50ZXJzZWN0KHNlZzFhOiBJUG9pbnQ2NCwgc2VnMWI6IElQb2ludDY0LCBzZWcyYTogSVBvaW50NjQsIHNlZzJiOiBJUG9pbnQ2NCwgaW5jbHVzaXZlOiBib29sZWFuID0gZmFsc2UpOiBib29sZWFuIHtcclxuICAgIGlmIChpbmNsdXNpdmUpIHtcclxuICAgICAgY29uc3QgcmVzMSA9IEludGVybmFsQ2xpcHBlci5jcm9zc1Byb2R1Y3Qoc2VnMWEsIHNlZzJhLCBzZWcyYik7XHJcbiAgICAgIGNvbnN0IHJlczIgPSBJbnRlcm5hbENsaXBwZXIuY3Jvc3NQcm9kdWN0KHNlZzFiLCBzZWcyYSwgc2VnMmIpO1xyXG4gICAgICBpZiAocmVzMSAqIHJlczIgPiAwKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgIGNvbnN0IHJlczMgPSBJbnRlcm5hbENsaXBwZXIuY3Jvc3NQcm9kdWN0KHNlZzJhLCBzZWcxYSwgc2VnMWIpO1xyXG4gICAgICBjb25zdCByZXM0ID0gSW50ZXJuYWxDbGlwcGVyLmNyb3NzUHJvZHVjdChzZWcyYiwgc2VnMWEsIHNlZzFiKTtcclxuICAgICAgaWYgKHJlczMgKiByZXM0ID4gMCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICByZXR1cm4gKHJlczEgIT09IDAgfHwgcmVzMiAhPT0gMCB8fCByZXMzICE9PSAwIHx8IHJlczQgIT09IDApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIChJbnRlcm5hbENsaXBwZXIuY3Jvc3NQcm9kdWN0KHNlZzFhLCBzZWcyYSwgc2VnMmIpICogSW50ZXJuYWxDbGlwcGVyLmNyb3NzUHJvZHVjdChzZWcxYiwgc2VnMmEsIHNlZzJiKSA8IDApICYmXHJcbiAgICAgICAgKEludGVybmFsQ2xpcHBlci5jcm9zc1Byb2R1Y3Qoc2VnMmEsIHNlZzFhLCBzZWcxYikgKiBJbnRlcm5hbENsaXBwZXIuY3Jvc3NQcm9kdWN0KHNlZzJiLCBzZWcxYSwgc2VnMWIpIDwgMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIGdldENsb3Nlc3RQdE9uU2VnbWVudChvZmZQdDogSVBvaW50NjQsIHNlZzE6IElQb2ludDY0LCBzZWcyOiBJUG9pbnQ2NCk6IElQb2ludDY0IHtcclxuICAgIGlmIChzZWcxLnggPT09IHNlZzIueCAmJiBzZWcxLnkgPT09IHNlZzIueSkgcmV0dXJuIHNlZzE7XHJcbiAgICBjb25zdCBkeCA9IHNlZzIueCAtIHNlZzEueDtcclxuICAgIGNvbnN0IGR5ID0gc2VnMi55IC0gc2VnMS55O1xyXG4gICAgbGV0IHEgPSAoKG9mZlB0LnggLSBzZWcxLngpICogZHggKyAob2ZmUHQueSAtIHNlZzEueSkgKiBkeSkgLyAoKGR4ICogZHgpICsgKGR5ICogZHkpKTtcclxuICAgIGlmIChxIDwgMCkgcSA9IDA7IGVsc2UgaWYgKHEgPiAxKSBxID0gMTtcclxuICAgIC8vIHVzZSBNaWRwb2ludFJvdW5kaW5nLlRvRXZlbiBpbiBvcmRlciB0byBleHBsaWNpdGx5IG1hdGNoIHRoZSBuZWFyYnlpbnQgYmVoYXZpb3VyIG9uIHRoZSBDKysgc2lkZVxyXG4gICAgcmV0dXJuIG5ldyBQb2ludDY0KFxyXG4gICAgICBzZWcxLnggKyBtaWRQb2ludFJvdW5kKHEgKiBkeCwgTWlkcG9pbnRSb3VuZGluZy5Ub0V2ZW4pLFxyXG4gICAgICBzZWcxLnkgKyBtaWRQb2ludFJvdW5kKHEgKiBkeSwgTWlkcG9pbnRSb3VuZGluZy5Ub0V2ZW4pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBwb2ludEluUG9seWdvbihwdDogSVBvaW50NjQsIHBvbHlnb246IFBhdGg2NCk6IFBvaW50SW5Qb2x5Z29uUmVzdWx0IHtcclxuICAgIGNvbnN0IGxlbiA9IHBvbHlnb24ubGVuZ3RoO1xyXG4gICAgbGV0IHN0YXJ0ID0gMDtcclxuXHJcbiAgICBpZiAobGVuIDwgMykgcmV0dXJuIFBvaW50SW5Qb2x5Z29uUmVzdWx0LklzT3V0c2lkZTtcclxuXHJcbiAgICB3aGlsZSAoc3RhcnQgPCBsZW4gJiYgcG9seWdvbltzdGFydF0ueSA9PT0gcHQueSkgc3RhcnQrKztcclxuICAgIGlmIChzdGFydCA9PT0gbGVuKSByZXR1cm4gUG9pbnRJblBvbHlnb25SZXN1bHQuSXNPdXRzaWRlO1xyXG5cclxuICAgIGxldCBkOiBudW1iZXIgPSAwO1xyXG4gICAgbGV0IGlzQWJvdmUgPSBwb2x5Z29uW3N0YXJ0XS55IDwgcHQueTtcclxuICAgIGNvbnN0IHN0YXJ0aW5nQWJvdmUgPSBpc0Fib3ZlO1xyXG4gICAgbGV0IHZhbCA9IDA7XHJcbiAgICBsZXQgaSA9IHN0YXJ0ICsgMTtcclxuICAgIGxldCBlbmQgPSBsZW47XHJcblxyXG4gICAgZm9yICg7IDspIHtcclxuICAgICAgaWYgKGkgPT09IGVuZCkge1xyXG4gICAgICAgIGlmIChlbmQgPT09IDAgfHwgc3RhcnQgPT09IDApIGJyZWFrO1xyXG4gICAgICAgIGVuZCA9IHN0YXJ0O1xyXG4gICAgICAgIGkgPSAwO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoaXNBYm92ZSkge1xyXG4gICAgICAgIHdoaWxlIChpIDwgZW5kICYmIHBvbHlnb25baV0ueSA8IHB0LnkpIGkrKztcclxuICAgICAgICBpZiAoaSA9PT0gZW5kKSBjb250aW51ZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB3aGlsZSAoaSA8IGVuZCAmJiBwb2x5Z29uW2ldLnkgPiBwdC55KSBpKys7XHJcbiAgICAgICAgaWYgKGkgPT09IGVuZCkgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGN1cnIgPSBwb2x5Z29uW2ldO1xyXG4gICAgICBjb25zdCBwcmV2ID0gaSA+IDAgPyBwb2x5Z29uW2kgLSAxXSA6IHBvbHlnb25bbGVuIC0gMV07XHJcblxyXG4gICAgICBpZiAoY3Vyci55ID09PSBwdC55KSB7XHJcbiAgICAgICAgaWYgKGN1cnIueCA9PT0gcHQueCB8fCAoY3Vyci55ID09PSBwcmV2LnkgJiYgKHB0LnggPCBwcmV2LnggIT09IHB0LnggPCBjdXJyLngpKSkgcmV0dXJuIFBvaW50SW5Qb2x5Z29uUmVzdWx0LklzT247XHJcbiAgICAgICAgaSsrO1xyXG4gICAgICAgIGlmIChpID09PSBzdGFydCkgYnJlYWs7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChwdC54IDwgY3Vyci54ICYmIHB0LnggPCBwcmV2LngpIHtcclxuICAgICAgICAvLyB3ZSdyZSBvbmx5IGludGVyZXN0ZWQgaW4gZWRnZXMgY3Jvc3Npbmcgb24gdGhlIGxlZnRcclxuICAgICAgfSBlbHNlIGlmIChwdC54ID4gcHJldi54ICYmIHB0LnggPiBjdXJyLngpIHtcclxuICAgICAgICB2YWwgPSAxIC0gdmFsOyAvLyB0b2dnbGUgdmFsXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZCA9IEludGVybmFsQ2xpcHBlci5jcm9zc1Byb2R1Y3QocHJldiwgY3VyciwgcHQpO1xyXG4gICAgICAgIGlmIChkID09PSAwKSByZXR1cm4gUG9pbnRJblBvbHlnb25SZXN1bHQuSXNPbjtcclxuICAgICAgICBpZiAoKGQgPCAwKSA9PT0gaXNBYm92ZSkgdmFsID0gMSAtIHZhbDtcclxuICAgICAgfVxyXG4gICAgICBpc0Fib3ZlID0gIWlzQWJvdmU7XHJcbiAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNBYm92ZSAhPT0gc3RhcnRpbmdBYm92ZSkge1xyXG4gICAgICBpZiAoaSA9PT0gbGVuKSBpID0gMDtcclxuICAgICAgZWxzZSBkID0gSW50ZXJuYWxDbGlwcGVyLmNyb3NzUHJvZHVjdChwb2x5Z29uW2kgLSAxXSwgcG9seWdvbltpXSwgcHQpO1xyXG4gICAgICBpZiAoZCA9PT0gMCkgcmV0dXJuIFBvaW50SW5Qb2x5Z29uUmVzdWx0LklzT247XHJcbiAgICAgIGlmICgoZCA8IDApID09PSBpc0Fib3ZlKSB2YWwgPSAxIC0gdmFsO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh2YWwgPT09IDApIHJldHVybiBQb2ludEluUG9seWdvblJlc3VsdC5Jc091dHNpZGU7XHJcbiAgICByZXR1cm4gUG9pbnRJblBvbHlnb25SZXN1bHQuSXNJbnNpZGU7XHJcbiAgfVxyXG59XHJcbiJdfQ==